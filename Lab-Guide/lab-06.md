# Microsoft Fabric
## Fabric Analyst in a Day
ラボ 6
バージョン: 2024 年 3 月

 
# 目次
概要	3<br>
Lakehouse	3<br>
タスク 1: SQL を使用してデータをクエリする	3<br>
タスク 2: T-SQL 結果を視覚化する	6<br>
タスク 3: ビジュアルクエリを作成する	9<br>
タスク 4: クエリ結果を視覚化する	13<br>
タスク 5: リレーションシップを作成する	14<br>
タスク 6: メジャーを作成する	17<br>
タスク 7: オプションセクション– リレーションシップを作成する	20<br>
タスク 8: オプションセクション– メジャーを作成する	24<br>
リファレンス	26<br>

 
## 概要

さまざまなソースからのデータが Lakehouse  に取り込まれています。このラボでは、データモデルを操作します。通常、リレーションシップの作成やメジャーの追加などのモデリング アクティビティはPower BI Desktop で実行していました。ここでは、サービス内でこれらのモデリングアクティビティを実行する方法を学びます。

このラボを終了すると、次のことが学べます。

- Lakehouse について詳しく調べる方法
- Lakehouse で SQL ビューを確認する方法
- Lakehouse でデータ モデリングを確認する方法

## Lakehouse
タスク 1: SQL を使用してデータをクエリする
1.	ラボ 2 のタスク 9 で作成した Fabric ワークスペース FAIAD_<ユーザー名> に戻りましょう。

2.	レイクハウス、セマンティックモデル、SQL エンドポイントという 3 種類の lh_FAIAD が表示されます。Lakehouse オプションについては前のラボで確認しました。SQL オプショ
ンを確認するために、lh_FAIAD SQL 分析エンドポイント オプションを選択します。エク
スプローラーの SQL ビューが表示されます。

 
データ モデルを作成する前にデータを調べたい場合は、SQL を使用して行うことができます。SQL を使用する 2 つのオプションを見てみましょう。1 つ目は開発者向けで、2 つ目はアナリスト向けです。
たとえば、SQL を使用して、サプライヤーが販売した単位数をすばやく調べたいとします。SQL  ステートメントを記述するか、ビジュアルを使用して SQL  ステートメントを作成する2 つのオプションがあります。
左側のパネルに [テーブル] が表示されています。[テーブル] を展開すると、テーブルを構成する [列] を表示できます。また、SQL ビュー、関数、ストアド プロシージャを作成するオプションもあります。SQL の知識がある場合は、これらのオプションを自由に検討してください。では、簡単な SQL クエリを記述してみましょう。

3.	上部のメニューで新規 SQL クエリを選択するか、左側のパネルの下部でクエリを選択します。SQL クエリ ビューが表示されます。

 
4.	以下の SQL  クエリをクエリ ウィンドウに貼り付けます。このクエリは、サプライヤー名
ごとに単位数を返します。Sales テーブルをProduct テーブルおよび Supplier テーブルと結合して、これを実現します。

SELECT su.Supplier_Name, SUM(Quantity) as Units FROM dbo.Sales s
JOIN dbo.Product p on p.StockItemID = s.StockItemID JOIN dbo.Supplier su on su.SupplierID = p.SupplierID GROUP BY su.Supplier_Name

5.	実行をクリックして結果を表示します。

6.	ビューとして保存を選択すると、このクエリをビューとして保存できます。

7.	左側のエクスプローラー パネルのクエリ セクションで、このクエリがマイ クエリの下に SQL query 1 として保存されています。ここで、クエリの名前を変更し、将来使用するために保存することができます。また、共有クエリ  フォルダーを使用して、共有されているクエリを表示することもできます。

 
タスク 2: T-SQL 結果を視覚化する
1.	このクエリの結果を視覚化することもできます。クエリ  ペインでクエリを強調表示し、
結果ペインを選択してから、このデータを探索するを選択します。

2.	SQL クエリの詳細ダイアログが開きます。データ ペインで、SQL query 1 を展開します。

3.	Supplier_Name および Units フィールドを選択します。集合横棒グラフが作成されます。

4.	視覚化セクションで、積み上げ縦棒グラフを選択して視覚化タイプを変更します。

 
5.	マトリックスを展開して、データをマトリックスとして表示します。

6.	画面右上の保存 -> レポートとして保存を選択します。

 
7.	[レポートの保存] ダイアログが開きます。Units by Supplier をレポートの名前を入力テキストボックスに入力します。

8.	保存先のワークスペースがご自身の Fabric ワークスペース FAIAD<ユーザー名> であることを確認します。

9.	保存を選択します。

完全なレポート エクスペリエンスが表示されます。視覚化の書式を設定するオプションがあります。これらのオプションについては、次のラボで確認します。

10.	左側のパネルから lh_FAIAD を選択します。

 
タスク 3: ビジュアルクエリを作成する
SQL 分析エンドポイント ビューに戻ります。SQL に詳しくない場合は、ビジュアル クエリを使用して同様のクエリを実行できます。
1.	上部のメニューで、新規のビジュアル クエリを選択します。ビジュアル クエリのペインが開きます。

2.	エクスプローラー ペインで、スキーマ -> dbo -> テーブルを展開します。

3.	Sales、Product、Supplier  テーブルをビジュアル  クエリのペインにドラッグします。

4.	Sales テーブルを選択した状態で、ビジュアル クエリ ペインのメニューから結合 -> クエリのマージを選択します。

 
5.	[マージ]  ダイアログボックスが開きます。マージ用の右テーブル ドロップダウンで、
Product を選択します。

6.	StockItemID を Sales テーブルと Product テーブルの両方で選択します。これは、Product テーブルと Sales テーブルをマージするためです。

7.	結合の種類で左外部を選択します。

8.	OK を選択します。

9.	結果ペインで、Product 列の横にある二重矢印をクリックします。

10.	ダイアログが開いたら、ダイアログから SupplierID  を選択します。

11.	OK を選択します。クエリのマージと Product の展開のステップが Sales テーブルに作成されていることを確認します。

 
12.	同様に、Supplier テーブルをマージしましょう。Sales テーブル内で + ([Product の展開] の後) を選択して新しいステップを追加します。ダイアログが開きます。

13.	結合 -> クエリのマージを選択します。

14.	[マージ]  ダイアログボックスが開きます。マージ用の右テーブル ドロップダウンで、
Supplier を選択します。

15.	SupplierID を Sales テーブルと Supplier テーブルの両方で選択します。これは、Supplier テーブルと Sales テーブルをマージするためです。

16.	結合の種類で左外部を選択します。

17.	OK を選択します。

 
18.	結果ペインで、Supplier 列の横にある二重矢印をクリックします。

19.	ダイアログが開いたら、ダイアログから Supplier_Name  を選択します。

20.	OK を選択します。Sales テーブルで、マージされたクエリ数が追加され、ステップが記録されていることに注意してください。

21.	ここでは、Supplier 名でグループ化して、Supplier 別の数量を取得しましょう。Sales
テーブル内で + ([Supplier の展開] の後) を選択して新しいステップを追加します。ダイアログが開きます。

22.	テーブルの変換 -> グループ化を選択します。[グループ化] ダイアログが開きます。

23.	グループ化ドロップダウンから、Supplier_Name を選択します。

24.	マージ クエリダイアログのスクリーンショットとして Units と入力します。

25.	操作を合計に設定します

26.	列ドロップダウンから Quantity を選択します。

27.	OK を選択します。
 
 

すべてのステップが Sales ブロックに記録されていることに注意してください。(タスク 4 の下の最初のスクリーン ショットを参照してください)。


タスク 4: クエリ結果を視覚化する
1.	クエリの準備ができたので、結果を見てみましょう。[結果]   ペインで結果の可視化を選択します。

2.	[結果の可視化] ダイアログが開きます。右側のデータ ペインから、ビジュアル クエリ 1
を展開します。

3.	Supplier_Name および Units フィールドを選択します。
 
4.	結果が先ほどの SQL クエリの結果と似ていることがわかります。必要に応じて、このレポートを保存できます。同様のレポートを前に保存したため、ここではキャンセルを選 択します。



タスク 5: リレーションシップを作成する
これで、モデルの構築、テーブル間のリレーションシップの構築、メジャーの作成を行う準 備が整いました。
1.	下部パネルから、モデルを選択します。中央のペインが、Power BI Desktop に表示されるモデル ビューと似ていることがわかります。

2.	必要に応じてテーブルのサイズと配置を変更します。

3.	Sales テーブルとReseller テーブルの間にリレーションシップを作成しましょう。Sales テーブルで ResellerID を選択して、Reseller テーブルの ResellerID までドラッグします。
 
 

4.	[新しいリレーションシップ] ダイアログが開きます。Table 1 が Sales、列が ResellerID であることを確認します。

5.	Table 2 が Reseller、列が ResellerID であることを確認します。

6.	カーディナリティが多対一(*:1) であることを確認します。

7.	クロス フィルターの方向が Single であることを確認します。

8.	OK を選択します。

 
9.	同様に、Sales テーブルと Date テーブルの間にリレーションシップを作成しましょう。
Sales テーブルで InvoiceDate を選択して、Date テーブルの Date までドラッグします。

10.	[新しいリレーションシップ] ダイアログが開きます。Table 1 が Sales、列が InvoiceDate
であることを確認します。

11.	Table 2 が Date、列が Date であることを確認します。

12.	カーディナリティが多対一(*:1) であることを確認します。

13.	クロス フィルターの方向が Single であることを確認します。

14.	OK を選択します。

15.	同じようにして、Sales テーブルと Product テーブルの間の多対一リレーションシップを作成します。Sales テーブルの StockItemID と Product テーブルの StockItemID を選択します。

16.	上部メニューからレポート - > セマンティック モデル オブジェクトを自動的に更新する
を選択し、モデルを保存して更新します。

 
チェックポイント: 以下のスクリーンショットに示すように、このモデルには 3 つのリレーションシップ(Sales とReseller テーブルの間、Sales と Date テーブルの間、Sales とProduct
テーブルの間) が必要です。

時間の都合上、すべてのリレーションシップの作成は行いません。時間があれば、ラボの最 後にあるオプション セクションを完了してください。オプション セクションでは、残りのリレーションシップを作成するステップについて説明しています。


タスク 6: メジャーを作成する
Sales ダッシュボードを作成するために必要ないくつかのメジャーを追加しましょう。
1.	モデル ビューで Sales テーブル を選択します。Sales テーブルにメジャーを追加するためです。

2.	上部のメニューから、ホーム-> 新しいメジャーを選択します。数式バーが表示されます。

3.	数式バーに Sales = SUM(Sales[Sales_Amount]) と入力します。

4.	数式バーの左側のチェック   マークをクリックするか、入力ボタンをクリックします。
 
5.	右側の [プロパティ]  パネルで、書式設定セクションを展開します。

6.	書式ドロップダウンで整数を選択します。

7.	上部のメニューで Sales テーブルを選択した状態で、ホーム -> 新しいメジャーを選択します。数式バーが表示されます。

8.	数式バーに Units = SUM(Sales[Quantity]) と入力します。

9.	数式バーの左側のチェック   マークをクリックするか、入力ボタンをクリックします。

10.	右側の [プロパティ] パネルで書式設定セクションを展開します ([プロパティ] パネルが読み込むまでに少し時間がかかる場合があります)。

11.	書式ドロップダウンで整数を選択します。

 
12.	上部のメニューで Sales テーブルを選択した状態で、ホーム -> 新しいメジャーを選択します。数式バーが表示されます。

13.	数式バーに Orders = DISTINCTCOUNT(Sales[InvoiceID]) と入力します。

14.	数式バーの左側のチェック   マークをクリックするか、入力ボタンをクリックします。

15.	右側の [プロパティ]  パネルで、書式設定セクションを展開します。

16.	書式ドロップダウンで整数を選択します。

ここでも、時間の都合上、すべてのメジャーの作成は行いません。時間があれば、ラボの最 後にあるオプション セクションを完了してください。このオプション セクションでは、残りのメジャーを作成するステップについて説明しています。
データ モデルを作成したところで、次のステップではレポートを作成します。これは次のラボで行います。
 
タスク 7: オプションセクション– リレーションシップを作成する
残りのリレーションシップを追加しましょう。
1.	同様に、Sales と People の間の多対一リレーションシップを作成します。Sales の
SalespersonPersonID と People の PersonID を選択します。
チェックポイント:    モデルは下のスクリーンショットのようになっているはずです。

2.	次は、Product とSupplier の間にリレーションシップを作成しましょう。Product テーブルで SupplierID を選択して、Supplier テーブルの SupplierID までドラッグします。

3.	[新しいリレーションシップ] ダイアログが開きます。Table 1 が Product、列が SupplierID
であることを確認します。

4.	Table 2 が Supplier、列が SupplierID であることを確認します。

5.	カーディナリティが多対一(*:1) であることを確認します。

6.	クロス  フィルターの方向が双方向であることを確認します。

7.	OK を選択します。
 
 

8.	同様に、Product_Details と Product の間に、クロス フィルターの方向を双方向として多対一リレーションシップを作成します。Product_Details の StockItemID と Product のStockItemID を選択します。

9.	次は、Reseller とGeo の間にリレーションシップを作成しましょう。Reseller テーブルで
PostalCityID を選択して、Geo テーブルの CityID までドラッグします。

10.	[新しいリレーションシップ] ダイアログが開きます。Table 1 が Reseller、列がPostalCityID であることを確認します。

11.	Table 2 が Geo、列が CityID であることを確認します。

12.	カーディナリティが多対一(*:1) であることを確認します。

13.	クロス  フィルターの方向が双方向であることを確認します。

14.	OK を選択します。

15.	次は、Customer とReseller の間にリレーションシップを作成しましょう。Customer テーブルで ResellerID を選択して、Reseller テーブルの ResellerID までドラッグします。
 
16.	[新しいリレーションシップ] ダイアログが開きます。Table 1 が Customer、列がResellerID であることを確認します。

17.	Table 2 が Reseller、列が ResellerID であることを確認します。

18.	カーディナリティが多対一(*:1) であることを確認します。

19.	クロス フィルターの方向が Single であることを確認します。

20.	OK を選択します。

チェックポイント:    モデルは下のスクリーンショットのようになっているはずです。

 
21.	次は、PO と Date の間にリレーションシップを作成しましょう。PO テーブルで
Order_Date を選択して、Date テーブルの Date までドラッグします。

22.	[新しいリレーションシップ] ダイアログが開きます。Table 1 が PO、列が Order_Date であることを確認します。

23.	Table 2 が Date、列が Date であることを確認します。

24.	カーディナリティが多対一(*:1) であることを確認します。

25.	クロス フィルターの方向が Single であることを確認します。

26.	OK を選択します。

27.	同様に、PO と Product の間の多対一リレーションシップを作成します。PO の
StockItemID と Product の StockItemID を選択します。

28.	同様に、PO と People の間の多対一リレーションシップを作成します。PO の
ContactPersonID と People の PersonID を選択します。すべてのリレーションシップの作成が完了しました。
チェックポイント:    モデルは下のスクリーンショットのようになっているはずです。
 
 


タスク 8: オプションセクション– メジャーを作成する
残りのメジャーを追加しましょう。
1.	上部のメニューで Sales テーブルを選択し、テーブル ツール-> 新しいメジャーを選択します。

2.	数式バーに Avg Order = DIVIDE([Sales], [Orders]) と入力します。

3.	数式バーのチェック マークをクリックするか、[入力]  ボタンをクリックします。

4.	メジャーが保存されたら、上部メニューの [メジャーツール] オプションに注目してください。メジャー ツールをクリックします。

5.	[書式] ドロップダウンで 10 進数を選択します。
 
 

6.	同様のステップを実行して、次のメジャーを追加します。
a.	GM = SUM(Sales[Line_Profit]) (書式設定は 10 進数)。
b.	GM% = DIVIDE([GM], [Sales]) (書式設定はパーセンテージ)。
c.	No of Customers = COUNTROWS(Customer)（書式設定は 整数）
 
リファレンス
Fabric Analyst in a Day (FAIAD) では、Microsoft Fabric で使用できる主要な機能の一部をご紹介します。サービスのメニューにあるヘルプ (?) セクションには、いくつかの優れたリソースへのリンクがあります。

Microsoft Fabric の次のステップに役立つリソースをいくつか以下に紹介します。

•	ブログ記事で Microsof t Fabric のGA に関するお知らせの全文を確認する
•	ガイド付きツアーを通じて Fabric を探索する
•	Microsof t Fabric の無料試用版にサインアップする
•	Microsof t Fabric のWeb サイトにアクセスする
•	Fabric の学習モジュールで新しいスキルを学ぶ
•	Fabric の技術ドキュメントを参照する
 
•	Fabric 入門編の無料のe-book を読む
•	Fabric コミュニティに参加し、質問の投稿やフィードバックの共有を行い、他のユーザーから学びを得る
より詳しい Fabric  エクスペリエンスのお知らせに関するブログを参照してください。

•	Fabric の Data Factory エクスペリエンスに関するブログ
•	Fabric のSynapse Data Engineering エクスペリエンスに関するブログ
•	Fabric のSynapse Data Science エクスペリエンスに関するブログ
•	Fabric のSynapse Data Warehousing エクスペリエンスに関するブログ
•	Fabric のSynapse Real-Time Analytics エクスペリエンスに関するブログ
•	Power BI のお知らせに関するブログ
•	Fabric の Data Activator エクスペリエンスに関するブログ
•	Fabric の管理とガバナンスに関するブログ
•	Fabric の OneLake に関するブログ
•	Dataverse とMicrosof t Fabric の統合に関するブログ



© 2023 Microsoft Corporation. All rights reserved.

このデモ/ラボを使用すると、次の条件に同意したことになります。

このデモ/ラボで説明するテクノロジまたは機能は、ユーザーのフィードバックを取得 し、学習エクスペリエンスを提供するために、Microsoft Corporation によって提供されます。ユーザーは、このようなテクノロジおよび機能を評価し、Microsoft にフィードバックを提供するためにのみデモ/ラボを使用できます。それ以外の目的には使用できませ ん。このデモ/ラボまたはその一部を、変更、コピー、配布、送信、表示、実行、再現、 発行、ライセンス、著作物の作成、転送、または販売することはできません。
複製または再頒布のために他のサーバーまたは場所にデモ/ラボ (またはその一部) をコピーまたは複製することは明示的に禁止されています。
 
このデモ/ラボは、前に説明した目的のために複雑なセットアップまたはインストールを 必要としないシミュレーション環境で潜在的な新機能や概念などの特定のソフトウェアテクノロジ/製品の機能を提供します。このデモ/ラボで表されるテクノロジ/概念は、フル機能を表していない可能性があり、最終バージョンと動作が異なることがあります。また、そのような機能や概念の最終版がリリースされない場合があります。物理環境でこのような機能を使用するエクスペリエンスが異なる場合もあります。
フィードバック。このデモ/ラボで説明されているテクノロジ、機能、概念に関する フィードバックをMicrosoft に提供する場合、ユーザーは任意の方法および目的でユー
ザーのフィードバックを使用、共有、および商品化する権利を無償で Microsoft に提供するものとします。また、ユーザーは、フィードバックを含む Microsoft のソフトウェアまたはサービスの特定部分を使用したり特定部分とインターフェイスを持ったりする製 品、テクノロジ、サービスに必要な特許権を無償でサード パーティに付与します。ユーザーは、フィードバックを含めるために Microsoft がサード パーティにソフトウェアま たはドキュメントをライセンスする必要があるライセンスの対象となるフィードバックを提供しません。これらの権限は、本契約の後も存続します。
Microsoft Corporation は、明示、黙示、または法律上にかかわらず、商品性のすべての保証および条件、特定の目的、タイトル、非侵害に対する適合性など、デモ/ラボに関する すべての保証および条件を拒否します。Microsoft は、デモ/ラボから派生する結果、出力の正確さ、任意の目的に対するデモ/ラボに含まれる情報の適合性に関して、いかなる 保証または表明もしません。
免責事項

このデモ/ラボには、Microsoft Power BI の新機能と機能強化の一部のみが含まれています。一部の機能は、製品の将来のリリースで変更される可能性があります。このデモ/ラ ボでは、新機能のすべてではなく一部について学習します。

